# [Web Application Security Testing](../README.md) -> __Report for the 20231211 lesson 1__

- [Web Application Security Testing -\> __Report for the 20231211 lesson 1__](#web-application-security-testing---report-for-the-20231211-lesson-1)
  - [__STATEMENT OF CONFIDENTIALITY__](#statement-of-confidentiality)
  - [__Introduction__](#introduction)
  - [__Document Properties__](#document-properties)
  - [__Version control__](#version-control)
  - [__List Of Illustrations__](#list-of-illustrations)
  - [__1. EXECUTIVE SUMMARY__](#1-executive-summary)
    - [1.1 Scope of work](#11-scope-of-work)
    - [1.2 Project Objectives](#12-project-objectives)
    - [1.3 Assumption](#13-assumption)
    - [1.4 Timeline](#14-timeline)
    - [1.5 Summary of Findings](#15-summary-of-findings)
    - [1.6 Summary of Recommendation](#16-summary-of-recommendation)
  - [__2. METHODOLOGY__](#2-methodology)
    - [2.1 Information Gathering](#21-information-gathering)
    - [2.2 Planning](#22-planning)
    - [2.3 Exploitation](#23-exploitation)
    - [2.4 Reporting](#24-reporting)
      - [*1.1 - Recon Flag1*](#11---recon-flag1)
      - [*1.3 - Recon Flag3*](#13---recon-flag3)
      - [*1.5 - Recon Flag5*](#15---recon-flag5)
      - [*1.6 - Recon Flag6*](#16---recon-flag6)

## __STATEMENT OF CONFIDENTIALITY__

The contents of this document were developed by Selivonchik S. I believe that the contents of this document are not proprietary or business confidential information. This information should be used for educational purposes only. This document may be transferred to any other person without my prior consent. In addition, any part of this document may be transmitted, reproduced, copied or distributed without prior consent.

The contents of this document do not constitute legal advice and should not be construed as such. This is the result of my own educational process. The assessment detailed here is conducted on a fictitious company for training and testing purposes, and the vulnerabilities do not impact external or internal infrastructure in any way.

## __Introduction__

Black Box Penetration Testing
For IT Academy WAST Course Lesson 1
V1.0

December 21th, 2023

By: Selivonchyk S.

## __Document Properties__

| Title             | Black Box Penetration Testing Report  | Contacts  |
|-------------------|---------------------------------------|-----------|
| Version           | V1.0                                  |           |
| Author            | Selivonchyk S.                        |           |
| Pen-testers       | Selivonchyk S.                        |           |
| Reviewed By       | Kutaisov M.                           |           |
| Approved By       | Kutaisov M.                           |           |
| Classification    | Not confidential                      |           |

## __Version control__

| Version   | Date              | Author                | Description   |
|-----------|-------------------|-----------------------|---------------|
| V1.0      | Dec 21th, 2023    | Selivonchyk Sergey    | CTF           |

Table of Content

1. EXECUTIVE SUMMARY
   1. [Scope of work](#11-scope-of-work)
   2. [Project objectives](#12-project-objectives)
   3. [Assumption](#13-assumption)
   4. [Timeline](#14-timeline)
   5. [Summary of findings](#15-summary-of-findings)
   6. [Summary of recommendation](#16-summary-of-recommendation)
2. METHODOLOGY
   1. [Information gathering](#21-information-gathering)
   2. [Planning](#22-planning)
   3. [Exploitation](#23-exploitation)
   4. [Reporting](#24-reporting)

APPENDIX A NESSUS VULNERABILITY SCANNING REPORTS

## __List Of Illustrations__

- List of Tables

  - __Table 1__ *Scope details*
  - __Table 2__ *Penetration Testing Time Line*
  - __Table 3__ *Total Risk and Confidence Rating*
  - __Table 4__ *Risk Analysis*

- List of Figures

  - __Figure 1__ *Сhallenges*
  - __Figure 2__ *Target*
  - __Figure 3__ *Task: 1.1 - Recon Flag1*
  - __Figure 4__ *Task: 1.3 - Recon Flag3*
  - __Figure 5__ *Task: 1.5 - Recon Flag1*
  - __Figure 6__ *Task: 1.6 - Recon Flag6 Step 1*
  - __Figure 7__ *Task: 1.6 - Recon Flag6 Step 2*
  - __Figure 8__ *Task: 1.6 - Recon Flag6 Step 3*

## __1. EXECUTIVE SUMMARY__

The IT Academy (*hereis "edu"*) provided Selivonchik S. with a special resource for training in conducting penetration testing of web applications in order to identify security weaknesses, capture the flag (*CTF*) and determine the degree of influence on them. As well as developing skills in documenting all research results in an understandable and reproducible form and developing skills in providing recommendations for correcting situations.

![CTF](./res/img/challenges.png)

> __Figure 1__ *Сhallenges*

### 1.1 Scope of work

This security assessment involves remote penetration testing of 1 available server located at 178.172.195.18 and port 11166.

![task](./res/img/task.png)

> __Figure 2__ *Target*

The assessment was conducted from a "black box" perspective, without credentials or any advance knowledge of internally facing environment with the goal of identifying unknown weaknesses, with the only information provided being the IP address and port of the server being tested. No other information was assumed at the start of the assessment.

In-Scope Assets

| Host/URL/IP Address/Port  | Description                   |
|---------------------------|-------------------------------|
| `178.172.195.18:11166`    | IT Academy external resource  |

> __Table 1:__ *Scope details*

### 1.2 Project Objectives

posture, identify vulnerabilities and potential flaws in its design in order to capture as many flags (*CTF*) as possible. Testing was conducted remotely via a host dedicated to this evaluation. Each identified vulnerability is assigned a threat-based risk rating and manually reviewed to determine its potential for exploitation and escalation.

### 1.3 Assumption

When writing the report, we assume that a special resource will be in the public domain for a short period of time and signing a non-disclosure agreement (*NDA*) and rules of interaction with it does not make sense.

### 1.4 Timeline

The timeline of the test is as below:

| Penetration Testing   | Start Date/Time   | End Date/Time |
|:---------------------:|:-----------------:|:-------------:|
| Pen Test 1            | 12/11/2023        | 12/20/2023    |

> __Table 2:__ *Penetration Testing Time Line*

### 1.5 Summary of Findings

This table shows the number of alerts for each __risk__ and __confidence level__ included in the report.

| Confidence:           | High  | Medium    | Low   | TOTAL |
|----------------------:|:-----:|:---------:|:-----:|------:|
| Risk Level __High__   | 0     | 0         | 0     | 0     |
| Risk Level __Medium__ | 1     | 2         | 0     | 3     |
| Risk Level __Low__    | 1     | 1         | 0     | 2     |
| Risk Level __Info__   | 0     | 1         | 0     | 1     |

> __Table 3:__ *Total Risk and Confidence Rating*

This table shows the number of vulnerabilities found by type, as well as their risk level.

| Vulnerability                                                                     | Severity  | Quantity  |
|----------------------------------------------------------------------------------:|:---------:|:---------:|
| [Content Security Policy (*CSP*) Header Not Set][CSPNotSet]                       | Medium    | 4         |
| [Missing Anti-clickjacking Header][AntiClick]                                     | Medium    | 3         |
| [Vulnerable JS Library][VulnJS]                                                   | Medium    | 1         |
| [Server Leaks Information via "X-Powered-By" HTTP Response Header][XPwdB]         | Low       | 3         |
| [Server Leaks Version Information via "Server" HTTP Response Header][ServLeak]    | Low       | 9         |
| [User Agent Fuzzer][UAFuzz]                                                       | Info      | 24        |
|                                                                                   |           |           |
| __Total__                                                                         | __6__     |           |

[CSPNotSet]:    ./MEDIUM_MissingCSPfaHTTPHeader.md
[AntiClick]:    ./MEDIUM_MissingCSPxfoHTTPHeader.md
[VulnJS]:       ./MEDIUM_VulnJSLib.md
[XPwdB]:        ./LOW_SrvLeakInfXPB.md
[ServLeak]:     ./LOW_SrvLeakInfServer.md
[UAFuzz]:       ./INFO_UAFazzer.md

> __Table 4:__ *Risk Analysis*

### 1.6 Summary of Recommendation

1. Ensure that the web server, application server, load balancer, etc. is configured to set the *Content-Security-Policy* header. Set a __non-permissive__ *Content-Security-Policy frame-ancestors* header for all requested resources.
2. Modern web browsers support the *Content-Security-Policy* and `X-Frame-Options` HTTP headers. Make sure one of these is set on all web pages returned by the site or application. If the page is to be generated only by pages on the server (*eg it is part of a `FRAMESET`*) then `SAMEORIGIN` should be used, otherwise if the page will never be generated in a frame then `DENY` should be used. As an alternative, consider implementing the Content Security Policy's "*frame-ancestors*" directive.
3. Upgrade to the latest version of Bootstrap library.
4. Ensure that the application server sets the Content-Type header appropriately, and that it sets the *X-Content-Type-Options* header to `nosniff` for all web pages.

   If possible, ensure that the end user uses a standards-compliant and modern web browser that does not perform MIME-sniffing at all, or that can be directed by the web application/web server to not perform MIME-sniffing.

5. Ensure that your web server, application server, load balancer, etc. is configured to suppress the "*Server*" header or provide generic details.
6. It is necessary to develop special handler rules for the user agent (*firewall, application, etc.*). Depends on implementation.

## __2. METHODOLOGY__

```plantuml
@startuml methodology

title "Methodology"

left to right direction
scale 800 width

<style>
    title {
        FontSize 24
        FontColor black
    }
    package {
        BackGroundColor #49AFA6-FFFFFF
        FontColor Indigo
        FontSize 24
        HorizontalAlignment left
    }
    card {
        BackGroundColor #lightblue|BBBBFF
        FontColor white
        FontSize 24
        LineThickness 1
        LineColor black
    }
    rectangle {
        BackgroundColor CCCC33|FFAA44
        FontSize 20
        Margin 50 0 0 20
    }
</style>

skinparam componentStyle rectangle
skinparam rectangle {
    roundCorner 35
}

package "<color:Indigo><&task></color> Step 6: " as pkg6 {
    card "<color:Green><&check></color> <b>Reporting (Summarize)</b>" as s6

    rectangle "Sum up the information into practical\nsolutions: guides of reproduction, elimination\nrecommendations, risk assessment." as r6

    s6 .. r6
}

package "<color:Indigo><&task></color> Step 5: " as pkg5 {
    card "<color:Green><&check></color> <b>Risk Analysis and</b>\n<b>Remediation Suggestion</b>" as s5

    rectangle "After achieving the goal, an attempt is\nmade to assess the magnitude of all\nrisks and determine ways to eliminate them." as r5

    s5 .. r5
}

package "<color:Indigo><&task></color> Step 4: " as pkg4 {
    card "<color:Green><&check></color> <b>Exploitation (Attack)</b>" as s4

    rectangle "The attack itself. An attempt to carry out\na real hack of the system, gain access to\nclassified information and privilege escalation." as r4

    s4 .. r4
}

package "<color:Indigo><&task></color> Step 3: " as pkg3 {
    card "<color:Green><&check></color> <b>Vulnerability Analysis</b>" as s3

    rectangle "Select a set of potential problem areas,\nthe level of weaknesses, and the sensitivity\nof the information they might reveal." as r3

    s3 .. r3
}

package "<color:Indigo><&task></color> Step 2: " as pkg2 {
    card "<color:Green><&check></color> <b>Analysis  and  Planing</b>" as s2

    rectangle "Based on the gathered information,\nthe methods and toolsets needed to\ndig deeper into these assets are selected." as r2

    s2 .. r2
}

package "<color:Indigo><&task></color> Step 1: " as pkg1 {
    card "<color:Green><&check></color> <b>Information Gathering</b>" as s1

    rectangle "Collect information about web architecture,\nintegrations and other resources for profiling." as r1

    s1 .. r1
}

@enduml
```
<!--
![methodology](./res/diagrams/out/methodology.svg)
-->

> __Figure 2:__ *Penetration Testing Methodology*

### 2.1 Information Gathering

To find existing (*and/or hidden*) web objects, I used the DIRB web content scanner (*comes with Kali*).

```sh
dirb http://178.172.195.18:11166/ /home/vagrant/Downloads/fuzz.txt
```

> __NOTE:__
>
> - __fuzz.txt__ - additional dictionary

```sh
------------------------------------------------------
DIRB v2.22
By The Dark Raver

URL_BASE: http://178.172.195.18:11166/
WORDLIST_FILES: /home/vagrant/Downloads/fuzz.txt

FOUND: 75
------------------------------------------------------

-----------------------------------------------------------------------------------------------
http://178.172.195.18:11166/config.php                                  (CODE:200|SIZE:0)
http://178.172.195.18:11166/credentials.txt                             (CODE:200|SIZE:113)         <- FLAG + (PMA: Login + Password)
http://178.172.195.18:11166/home                                        (CODE:200|SIZE:1399)
http://178.172.195.18:11166/index.php                                   (CODE:200|SIZE:2392)
http://178.172.195.18:11166/php.ini                                     (CODE:200|SIZE:64)
http://178.172.195.18:11166/robots                                      (CODE:200|SIZE:77)
http://178.172.195.18:11166/robots.txt                                  (CODE:200|SIZE:77)          <- FLAG
http://178.172.195.18:11166/admin/index.php                             (CODE:200|SIZE:514)
http://178.172.195.18:11166/cgi-bin/                                    (CODE:403|SIZE:292)
http://178.172.195.18:11166/css/custom                                  (CODE:200|SIZE:527)
http://178.172.195.18:11166/js/main                                     (CODE:200|SIZE:379)         <- FLAG
http://178.172.195.18:11166/server-status                               (CODE:403|SIZE:297)
-----------------------------------------------------------------------------------------------
http://178.172.195.18:11166/phpmyadmin/ChangeLog                        (CODE:200|SIZE:12219)
http://178.172.195.18:11166/phpmyadmin/composer                         (CODE:200|SIZE:3189)
http://178.172.195.18:11166/phpmyadmin/favicon.ico                      (CODE:200|SIZE:22486)
http://178.172.195.18:11166/phpmyadmin/index.php                        (CODE:200|SIZE:14457)       <- FLAG (DB: Acad; Table: Flag)
http://178.172.195.18:11166/phpmyadmin/doc/html/_images/chart           (CODE:200|SIZE:35466)
http://178.172.195.18:11166/phpmyadmin/doc/html/bookmarks               (CODE:200|SIZE:10088)
http://178.172.195.18:11166/phpmyadmin/doc/html/charts                  (CODE:200|SIZE:15016)
http://178.172.195.18:11166/phpmyadmin/doc/html/config                  (CODE:200|SIZE:359162)
http://178.172.195.18:11166/phpmyadmin/doc/html/copyright               (CODE:200|SIZE:6572)
http://178.172.195.18:11166/phpmyadmin/doc/html/credits                 (CODE:200|SIZE:45625)
http://178.172.195.18:11166/phpmyadmin/doc/html/developers              (CODE:200|SIZE:4877)
http://178.172.195.18:11166/phpmyadmin/doc/html/faq                     (CODE:200|SIZE:202201)
http://178.172.195.18:11166/phpmyadmin/doc/html/glossary                (CODE:200|SIZE:33723)
http://178.172.195.18:11166/phpmyadmin/doc/html/index                   (CODE:200|SIZE:14976)
http://178.172.195.18:11166/phpmyadmin/doc/html/index.html              (CODE:200|SIZE:14976)
http://178.172.195.18:11166/phpmyadmin/doc/html/intro                   (CODE:200|SIZE:11055)
http://178.172.195.18:11166/phpmyadmin/doc/html/other                   (CODE:200|SIZE:7013)
http://178.172.195.18:11166/phpmyadmin/doc/html/require                 (CODE:200|SIZE:8462)
http://178.172.195.18:11166/phpmyadmin/doc/html/search                  (CODE:200|SIZE:3662)
http://178.172.195.18:11166/phpmyadmin/doc/html/security                (CODE:200|SIZE:12017)
http://178.172.195.18:11166/phpmyadmin/doc/html/settings                (CODE:200|SIZE:6266)
http://178.172.195.18:11166/phpmyadmin/doc/html/setup                   (CODE:200|SIZE:121361)
http://178.172.195.18:11166/phpmyadmin/doc/html/themes                  (CODE:200|SIZE:11438)
http://178.172.195.18:11166/phpmyadmin/doc/html/transformations         (CODE:200|SIZE:13570)
http://178.172.195.18:11166/phpmyadmin/doc/html/user                    (CODE:200|SIZE:8667)
http://178.172.195.18:11166/phpmyadmin/doc/html/vendors                 (CODE:200|SIZE:6222)
http://178.172.195.18:11166/phpmyadmin/js/ajax                          (CODE:200|SIZE:31246)
http://178.172.195.18:11166/phpmyadmin/js/chart                         (CODE:200|SIZE:18509)
http://178.172.195.18:11166/phpmyadmin/js/common                        (CODE:200|SIZE:19196)
http://178.172.195.18:11166/phpmyadmin/js/config                        (CODE:200|SIZE:27526)
http://178.172.195.18:11166/phpmyadmin/js/console                       (CODE:200|SIZE:57280)
http://178.172.195.18:11166/phpmyadmin/js/export                        (CODE:200|SIZE:35062)
http://178.172.195.18:11166/phpmyadmin/js/functions                     (CODE:200|SIZE:175177)
http://178.172.195.18:11166/phpmyadmin/js/import                        (CODE:200|SIZE:5640)
http://178.172.195.18:11166/phpmyadmin/js/indexes                       (CODE:200|SIZE:27654)
http://178.172.195.18:11166/phpmyadmin/js/navigation                    (CODE:200|SIZE:60012)
http://178.172.195.18:11166/phpmyadmin/js/replication                   (CODE:200|SIZE:3201)
http://178.172.195.18:11166/phpmyadmin/js/rte                           (CODE:200|SIZE:47688)
http://178.172.195.18:11166/phpmyadmin/js/sql                           (CODE:200|SIZE:38441)
http://178.172.195.18:11166/phpmyadmin/js/transformations/json          (CODE:200|SIZE:670)
http://178.172.195.18:11166/phpmyadmin/js/transformations/xml           (CODE:200|SIZE:665)
http://178.172.195.18:11166/phpmyadmin/js/vendor/jquery/jquery          (CODE:200|SIZE:9574)
http://178.172.195.18:11166/phpmyadmin/LICENSE                          (CODE:200|SIZE:18092)
http://178.172.195.18:11166/phpmyadmin/package                          (CODE:200|SIZE:729)
http://178.172.195.18:11166/phpmyadmin/phpinfo.php                      (CODE:200|SIZE:14459)
http://178.172.195.18:11166/phpmyadmin/print                            (CODE:200|SIZE:1213)
http://178.172.195.18:11166/phpmyadmin/README                           (CODE:200|SIZE:1520)
http://178.172.195.18:11166/phpmyadmin/robots                           (CODE:200|SIZE:26)
http://178.172.195.18:11166/phpmyadmin/robots.txt                       (CODE:200|SIZE:26)
http://178.172.195.18:11166/phpmyadmin/setup/ajax                       (CODE:200|SIZE:248)
http://178.172.195.18:11166/phpmyadmin/setup/index.php                  (CODE:200|SIZE:10518)
http://178.172.195.18:11166/phpmyadmin/setup/scripts                    (CODE:200|SIZE:6086)
http://178.172.195.18:11166/phpmyadmin/setup/styles                     (CODE:200|SIZE:10563)
http://178.172.195.18:11166/phpmyadmin/themes/dot                       (CODE:200|SIZE:43)
http://178.172.195.18:11166/phpmyadmin/themes/original/css/printview    (CODE:200|SIZE:2746)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/console      (CODE:200|SIZE:295)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/error        (CODE:200|SIZE:1150)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/hide         (CODE:200|SIZE:284)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/more         (CODE:200|SIZE:85)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/play         (CODE:200|SIZE:329)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/show         (CODE:200|SIZE:263)
http://178.172.195.18:11166/phpmyadmin/themes/original/img/spacer       (CODE:200|SIZE:68)
http://178.172.195.18:11166/phpmyadmin/themes/original/screen           (CODE:200|SIZE:22511)
http://178.172.195.18:11166/phpmyadmin/themes/original/theme            (CODE:200|SIZE:209)
http://178.172.195.18:11166/phpmyadmin/vendor/composer/LICENSE          (CODE:200|SIZE:1070)
-----------------------------------------------------------------------------------------------
```

### 2.2 Planning

Now we need to explore the resources found.

- `http://178.172.195.18:11166/index.php`
- `http://178.172.195.18:11166/credentials.txt`
- `http://178.172.195.18:11166/config.php`
- `http://178.172.195.18:11166/php.ini`
- `http://178.172.195.18:11166/robots.txt`
- `http://178.172.195.18:11166/admin/index.php`
- `http://178.172.195.18:11166/js/main`
- `http://178.172.195.18:11166/css/custom`
- `http://178.172.195.18:11166/phpmyadmin/index.php`

There are various tools for this. The choice of tool set depends on your goals. For web exploitation purposes I plan to use:

- Browser Developer Tools
- Perform a detour
- Basic SQL injection
- Swigger Port Resources

### 2.3 Exploitation

There are a few common places I can go to determine the current architecture:

- HTTP headers
- Cookie
- HTML, CSS and JS source code
- Specific files and folders.
- File extensions
- Error message

I can do all the research using standard browser development tools.

> __NOTE:__
>
> I think I may have to use __dirb__ or __dirbuster__ to search deeper for information about *Specific files and folders* and *File extensions*, but I've already done that in the [information gathering](#21-information-gathering) phase.

### 2.4 Reporting

I was able to find most of the flags using standard *browser development tools*.

#### *1.1 - Recon Flag1*

To find the first flag you need to do the following:

1. Open a browser and go to `http://178.172.195.18:11166/robots.txt`
2. The flag is here

   ![1.1 - Recon Flag1](./res/img/1.1%20-%20Recon%20Flag1.png)

   > __Figure 3__ *Task: 1.1 - Recon Flag1*

#### *1.3 - Recon Flag3*

To find the next flag you need to do the following:

1. Open a browser and go to `http://178.172.195.18:11166/admin/index.php`
2. Press [F12] to open *Developer Tools* (*for __Firefox__ browser*)
3. Select the "*Debugger*" tab.
4. On the left side, expand the `js` folder.
5. Select the `main.js` file to display its contents.
6. On __line 4__ you will find a flag.

   ![1.3 - Recon Flag3](./res/img/1.3%20-%20Recon%20Flag3.png)

   > __Figure 4__ *Task: 1.3 - Recon Flag3*

#### *1.5 - Recon Flag5*

To find the next flag you need to do the following:

1. Open a browser and go to `http://178.172.195.18:11166/credentials.txt`
2. The flag is here

   ![1.5 - Recon Flag5](./res/img/1.5%20-%20Recon%20Flag5.png)

   > __Figure 5__ *Task: 1.5 - Recon Flag1*

#### *1.6 - Recon Flag6*

To find the first flag you need to do the following:

1. Open a browser and go to `http://178.172.195.18:11166/credentials.txt`
2. Here we can find __login__ and __password__ (*during the [information gathering](#21-information-gathering) phase we found the __PhpMyAdmin__ panel and these credentials are possibly used to login*)

   ![1.6 - Recon Flag6 Step_01](./res/img/1.6%20-%20Recon%20Flag6%20Step_01.png)

   > __Figure 6__ *Task: 1.6 - Recon Flag6 Step 1*

3. Go to `http://178.172.195.18:11166/phpmyadmin/index.php` to verify the credentials
4. Insert `visitor` into __User__ and `1Z~QrV!GArv` into __Password__ field
5. Click `Next` button

   ![1.6 - Recon Flag6 Step_02](./res/img/1.6%20-%20Recon%20Flag6%20Step_02.png)

   > __Figure 7__ *Task: 1.6 - Recon Flag6 Step 2*

6. Digging deeper into the database structure, we found the `Acad` database and the `Flag` table.
7. By clicking on the `Flag` table, we found the following Flag.

   ![1.6 - Recon Flag6 Step_01](./res/img/1.6%20-%20Recon%20Flag6%20Step_03.png)

   > __Figure 8__ *Task: 1.6 - Recon Flag6 Step 3*
