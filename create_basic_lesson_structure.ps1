# BASIC DEFINITIONS
$numberOfAuxiliaryRepos = 4
$dirPath                = "$env:OneDrive\Desktop\001_PROJECTS_\009_PenTest_\001_STUDY_"

# STRUCTURE
#-------------------------------------------------------
# [<DATE>_Lesson_<NUMBER>]                  <--  DONE
# |
# ├►  [read]                                <--  DONE
# |   |
# |   └►  [diagrams]                        <--  DONE
# |       |
# |       ├►  [out]                         <--  DONE
# |       |
# |       └►  [src]                         <--  DONE
# |
# └►  [res]                                 <--  DONE
# |   |
# |   └►  [img]                             <--  DONE
# |       |
# |       └►  [screenshots]                 <--  DONE
# |
# ├►  [<DATE>_lesson_<NUMBER>.md]
# |
# └►  [report_for_the_<DATE>_lesson_<NUMBER>.md]
#------------------------------------------------------
$dirs                   = @('read','res')
$readSubDirs            = @(,'diagrams')
$diagramSubDirs         = @(,'out','src')
$resSubDirs             = @(,'img')
$imgSubDirs             = @(,'screenshots')

# PREPARATION
$currentDate       = (Get-Date).tostring("yyyyMMdd")
$lessonsNumber     = (Get-ChildItem -Path $dirPath -Directory -Force).Count - $numberOfAuxiliaryRepos
$currentLessonPath = "$dirPath\$($currentDate)_Lesson_$lessonsNumber"
$files             = @(, "$($currentDate)_lesson_$lessonsNumber.md", "report_for_the_$($currentDate)_lesson_$lessonsNumber.md")
# $tmpImgfiles       = @(, "pentest.webp")
$tmpDiagSrcfiles   = @(, "methodology.puml")
$tmpDiagfiles      = @(, "methodology.svg")

# CREATION
New-Item -Type Directory -Path $dirPath -Name "$($currentDate)_Lesson_$lessonsNumber"
foreach($dir in $dirs) {
    New-Item -Type Directory $currentLessonPath\$dir -Force
    if ($dir -eq "read"){
        foreach($rsDir in $readSubDirs) {
            New-Item -Type Directory $currentLessonPath\$dir\$rsDir -Force
            foreach($dDir in $diagramSubDirs) {New-Item -Type Directory $currentLessonPath\$dir\$rsDir\$dDir -Force}
        }
    }
    else {
        foreach($iDir in $resSubDirs) {
            New-Item -Type Directory $currentLessonPath\$dir\$iDir -Force
            foreach($sDir in $imgSubDirs) {New-Item -Type Directory $currentLessonPath\$dir\$iDir\$sDir -Force}
        }
    }
}
foreach($file in $files) {Copy-Item -Path .\res\templates\lesson$lessonsNumber.md -Destination $currentLessonPath\$file}
# foreach($iFile in $tmpImgfiles){Copy-Item -Path .\res\templates\res\img\$iFile -Destination $currentLessonPath\res\img\$iFile}
foreach($dsFile in $tmpDiagSrcfiles){Copy-Item -Path .\res\templates\res\diagrams\src\$dsFile -Destination $currentLessonPath\read\diagrams\src\$dsFile}
foreach($dFile in $tmpDiagfiles){Copy-Item -Path .\res\templates\res\diagrams\out\$dFile -Destination $currentLessonPath\read\diagrams\out\$dFile}
